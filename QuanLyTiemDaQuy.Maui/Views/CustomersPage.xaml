<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:QuanLyTiemDaQuy.Core.Models;assembly=QuanLyTiemDaQuy.Core"
             x:Class="QuanLyTiemDaQuy.Maui.Views.CustomersPage"
             Title="KhÃ¡ch hÃ ng">

    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Padding="16" BackgroundColor="{StaticResource Primary}">
            <SearchBar Placeholder="TÃ¬m khÃ¡ch hÃ ng..."
                       Text="{Binding SearchText}"
                       SearchCommand="{Binding SearchCommand}"
                       BackgroundColor="White"
                       PlaceholderColor="{StaticResource Gray400}"/>
            <Button Grid.Column="1"
                    Text="âž• ThÃªm KH"
                    Command="{Binding AddCustomerCommand}"
                    BackgroundColor="White"
                    TextColor="{StaticResource Primary}"
                    Margin="8,0,0,0"/>
        </Grid>

        <!-- Customer List -->
        <RefreshView Grid.Row="1" 
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding Customers}"
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedCustomer}"
                            SelectionChangedCommand="{Binding SelectCustomerCommand}"
                            SelectionChangedCommandParameter="{Binding SelectedCustomer}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Customer">
                        <Frame Margin="8,4" Padding="12" Style="{StaticResource Card}">
                            <Grid ColumnDefinitions="*,Auto">
                                <VerticalStackLayout>
                                    <Label Text="{Binding Name}" FontAttributes="Bold" FontSize="16"/>
                                    <Label Text="{Binding Phone}" TextColor="{StaticResource Gray600}"/>
                                </VerticalStackLayout>
                                <VerticalStackLayout Grid.Column="1" HorizontalOptions="End">
                                    <Label Text="{Binding Tier, TargetNullValue='ThÆ°á»ng'}" 
                                           TextColor="{Binding Tier, Converter={StaticResource TierToColorConverter}}"
                                           FontAttributes="Bold"/>
                                    <Label Text="{Binding TotalPurchase, StringFormat='{0:N0} â‚«'}" 
                                           Style="{StaticResource Caption}"
                                           HorizontalTextAlignment="End"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center">
                        <Label Text="ðŸ‘¥" FontSize="48" HorizontalTextAlignment="Center"/>
                        <Label Text="ChÆ°a cÃ³ khÃ¡ch hÃ ng" HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>
        
        <ActivityIndicator Grid.RowSpan="2" 
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Color="{StaticResource Primary}"/>
    </Grid>
</ContentPage>
